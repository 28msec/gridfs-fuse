SET(SHELLEXE "bash")
SET(DEPENDENT_LIB_DIRS "${MongoDB_LIBRARY_DIRS}") 

IF (APPLE)
  SET(TIMESTAMP_CMD "stat -f %c-%m-%a")
ELSE(APPLE)
  SET(TIMESTAMP_CMD "stat -c %Z-%Y-%X")
ENDIF(APPLE)

CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/simple.sh.in ${CMAKE_CURRENT_BINARY_DIR}/simple.sh @ONLY)
CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/parallel.sh.in ${CMAKE_CURRENT_BINARY_DIR}/parallel.sh @ONLY)
CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/commons.sh.in ${CMAKE_CURRENT_BINARY_DIR}/commons.sh @ONLY)

######
MACRO(GRIDFS_ADD_TEST TESTNAME SCRIPTNAME)
  MESSAGE(STATUS "ADD_TEST: ${TESTNAME} ${CMAKE_CURRENT_BINARY_DIR}/${SCRIPTNAME}")
  ADD_TEST(${TESTNAME} ${SHELLEXE} "${CMAKE_CURRENT_BINARY_DIR}/${SCRIPTNAME}" )
  IF (APPLE)
    SET_TESTS_PROPERTIES(${TESTNAME}
      PROPERTIES ENVIRONMENT "DYLD_LIBRARY_PATH=${DEPENDENT_LIB_DIRS}")
  ELSE(APPLE)
    SET_TESTS_PROPERTIES(${TESTNAME}
      PROPERTIES ENVIRONMENT "LD_LIBRARY_PATH=${DEPENDENT_LIB_DIRS}")
  ENDIF(APPLE)
ENDMACRO(GRIDFS_ADD_TEST)

# register tests
GRIDFS_ADD_TEST("gridfs-fuse-simple" simple.sh)
GRIDFS_ADD_TEST("gridfs-fuse-parallel" multiple.sh)
